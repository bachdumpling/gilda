<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1">

{%- liquid
  assign seo_site_name = settings.seo_site_name | default: shop.name
  assign og_title = page_title | default: seo_site_name
  assign og_url = canonical_url | default: request.origin
  assign og_type = 'website'
  assign og_description = page_description | default: settings.seo_default_description | default: shop.description | default: seo_site_name

  # Add location keywords to homepage title and description
  if request.page_type == 'index'
    assign additional_locations = settings.seo_additional_locations | default: ''
    assign business_city = settings.seo_business_city | default: ''

    # Enhance homepage title with location if available
    if business_city != blank or additional_locations != blank
      assign location_text = ''
      if business_city != blank
        assign location_text = business_city
      endif
      if additional_locations != blank
        if location_text != blank
          assign location_text = location_text | append: ', ' | append: additional_locations
        else
          assign location_text = additional_locations
        endif
      endif

      # Add location to title if not already present
      unless og_title contains location_text
        assign og_title = og_title | append: ' - ' | append: location_text
      endunless

      # Enhance description with location keywords
      unless og_description contains location_text
        assign og_description = og_description | append: ' Located in ' | append: location_text | append: '.'
      endunless
    endif
  endif

  if request.page_type == 'product'
    assign og_type = 'product'
  elsif request.page_type == 'article'
    assign og_type = 'article'
  elsif request.page_type == 'password'
    assign og_url = request.origin
  endif
%}

<meta
  property="og:site_name"
  content="{{ shop.name }}"
>
<meta
  property="og:url"
  content="{{ og_url }}"
>
<meta
  property="og:title"
  content="{{ og_title | escape }}"
>
<meta
  property="og:type"
  content="{{ og_type }}"
>
<meta
  property="og:description"
  content="{{ og_description | escape }}"
>

{%- liquid
  assign share_image = page_image | default: settings.share_image
-%}

{%- if share_image -%}
  <meta
    property="og:image"
    content="http:{{ share_image | image_url: width: 1200 }}"
  >
  <meta
    property="og:image:secure_url"
    content="https:{{ share_image | image_url: width: 1200 }}"
  >
  <meta
    property="og:image:width"
    content="{{ share_image.width }}"
  >
  <meta
    property="og:image:height"
    content="{{ share_image.height }}"
  >
  <meta
    property="og:image:alt"
    content="{{ share_image.alt | escape }}"
  >
{%- endif -%}

{%- if request.page_type == 'product' -%}
  <script type="application/ld+json">
    {{ product | structured_data }}
  </script>

  <meta
    property="og:price:amount"
    content="{{ product.price | money_without_currency | strip_html }}"
  >
  <meta
    property="og:price:currency"
    content="{{ cart.currency.iso_code }}"
  >
{%- endif -%}

<meta
  name="twitter:card"
  content="summary_large_image"
>
<meta
  name="twitter:title"
  content="{{ og_title | escape }}"
>
<meta
  name="twitter:description"
  content="{{ og_description | escape }}"
>
{%- if share_image -%}
  <meta
    name="twitter:image"
    content="https:{{ share_image | image_url: width: 1200 }}"
  >
  <meta
    name="twitter:image:alt"
    content="{{ share_image.alt | escape }}"
  >
{%- endif -%}

{%- liquid
  # Build title with location keywords for homepage
  assign title_text = page_title
  if request.page_type == 'index'
    assign additional_locations = settings.seo_additional_locations | default: ''
    assign business_city = settings.seo_business_city | default: ''

    if business_city != blank or additional_locations != blank
      assign location_text = ''
      if business_city != blank
        assign location_text = business_city
      endif
      if additional_locations != blank
        if location_text != blank
          assign location_text = location_text | append: ', ' | append: additional_locations
        else
          assign location_text = additional_locations
        endif
      endif

      unless title_text contains location_text
        assign title_text = title_text | append: ' - ' | append: location_text
      endunless
    endif
  endif
-%}
<title>
  {{ title_text }}
  {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
  {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
  {%- unless title_text contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
</title>

<link
  rel="canonical"
  href="{{ canonical_url }}"
>

{%- comment -%} Always show meta description with fallback {%- endcomment -%}
<meta
  name="description"
  content="{{ page_description | default: settings.seo_default_description | default: shop.description | default: seo_site_name | escape }}"
>

{%- comment -%} Organization structured data for local SEO {%- endcomment -%}
{%- liquid
  assign business_city = settings.seo_business_city | default: ''
  assign business_state = settings.seo_business_state | default: ''
  assign business_country = settings.seo_business_country | default: 'US'
  assign business_website = settings.seo_business_website | default: request.origin
  assign business_email = settings.seo_business_email | default: ''
  assign business_phone = settings.seo_business_phone | default: ''
-%}

{%- if business_city != blank or business_website != blank -%}
  {%- liquid
    # Count how many optional properties we'll include
    assign has_logo = false
    if share_image
      assign has_logo = true
    endif
    assign has_email = false
    if business_email != blank
      assign has_email = true
    endif
    assign has_phone = false
    if business_phone != blank
      assign has_phone = true
    endif
    assign has_address = false
    if business_city != blank
      assign has_address = true
    endif
    assign social_links = ''
    if settings.social_instagram_link != blank
      assign social_links = social_links | append: settings.social_instagram_link | append: '|'
    endif
    if settings.social_twitter_link != blank
      assign social_links = social_links | append: settings.social_twitter_link | append: '|'
    endif
    if settings.social_facebook_link != blank
      assign social_links = social_links | append: settings.social_facebook_link | append: '|'
    endif
    assign social_array = social_links | split: '|'
    assign social_count = social_array.size | minus: 1
    assign has_social = false
    if social_count > 0
      assign has_social = true
    endif
  -%}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "{{ shop.name | escape }}",
      "url": "{{ business_website }}"{%- if has_logo or has_email or has_phone or has_address or has_social -%},{%- endif -%}
      {%- if has_logo -%}
      "logo": "https:{{ share_image | image_url: width: 600 }}"{%- if has_email or has_phone or has_address or has_social -%},{%- endif -%}
      {%- endif -%}
      {%- if has_email -%}
      "email": "{{ business_email | escape }}"{%- if has_phone or has_address or has_social -%},{%- endif -%}
      {%- endif -%}
      {%- if has_phone -%}
      "telephone": "{{ business_phone | escape }}"{%- if has_address or has_social -%},{%- endif -%}
      {%- endif -%}
      {%- if has_address -%}
      "address": {
        "@type": "PostalAddress"{%- if business_city != blank or business_state != blank -%},{%- endif -%}
        {%- if business_city != blank -%}
        "addressLocality": "{{ business_city | escape }}"{%- if business_state != blank -%},{%- endif -%}
        {%- endif -%}
        {%- if business_state != blank -%}
        "addressRegion": "{{ business_state | escape }}",
        {%- endif -%}
        "addressCountry": "{{ business_country | escape }}"
      }{%- if has_social -%},{%- endif -%}
      {%- endif -%}
      {%- if has_social -%}
      "sameAs": [
        {%- for i in (0..social_count) -%}
          {%- if social_array[i] != blank -%}
            "{{ social_array[i] | escape }}"{%- unless forloop.last -%},{%- endunless -%}
          {%- endif -%}
        {%- endfor -%}
      ]
      {%- endif -%}
    }
  </script>
{%- endif -%}

{%- comment -%} Breadcrumb structured data {%- endcomment -%}
{%- if request.page_type == 'product' or request.page_type == 'collection' or request.page_type == 'article' -%}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ request.origin }}"
        }
        {%- if request.page_type == 'product' -%}
          {%- if product.collections.first -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": "{{ product.collections.first.title | escape }}",
            "item": "{{ request.origin }}{{ product.collections.first.url }}"
          }
          {%- endif -%}
          ,{
            "@type": "ListItem",
            "position": {%- if product.collections.first -%}3{%- else -%}2{%- endif -%},
            "name": "{{ product.title | escape }}",
            "item": "{{ request.origin }}{{ product.url }}"
          }
        {%- elsif request.page_type == 'collection' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": "{{ collection.title | escape }}",
            "item": "{{ request.origin }}{{ collection.url }}"
          }
        {%- elsif request.page_type == 'article' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": "{{ blog.title | escape }}",
            "item": "{{ request.origin }}{{ blog.url }}"
          }
          ,{
            "@type": "ListItem",
            "position": 3,
            "name": "{{ article.title | escape }}",
            "item": "{{ request.origin }}{{ article.url }}"
          }
        {%- endif -%}
      ]
    }
  </script>
{%- endif -%}
